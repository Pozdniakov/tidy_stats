<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.208">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Анализ данных и статистика в R - 10&nbsp; Введение в tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./120-tidyverse_advanced.html" rel="next">
<link href="./107-beyond_base_r.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Поиск не дал результатов",
    "search-matching-documents-text": "Результаты поиска",
    "search-copy-link-title": "Скопировать ссылку",
    "search-hide-matches-text": "Скрыть дополнительные результаты",
    "search-more-match-text": "дополнительный результат в этом документе",
    "search-more-matches-text": "дополнительных результата(-ов) в этом документе",
    "search-clear-button-title": "Очистить",
    "search-detached-cancel-button-title": "Отменить",
    "search-submit-button-title": "Найти"
  }
}</script>


</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./105-tidyverse.html">Tidyverse</a></li><li class="breadcrumb-item"><a href="./110-tidyverse_basic.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Введение в tidyverse</span></a></li></ol></nav>
      <a class="flex-grow-1" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Анализ данных и статистика в R</a> 
        <div class="sidebar-tools-main">
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Анализ-данных-и-статистика-в-R.pdf">
              <i class="bi bi-bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Анализ-данных-и-статистика-в-R.epub">
              <i class="bi bi-bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">О курсе</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./005-whole_r_intro.html" class="sidebar-item-text sidebar-link">Основы R и Rstudio</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010-intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Введение в R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./013-vector.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Вектор</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./016-complex_structures.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Сложные структуры данных в R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./020-install.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Пакеты в R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./030-import_data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Импорт и экспорт данных</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./040-if_for.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Условные конструкции и циклы</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./050-functional.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Функциональное программирование в R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./105-tidyverse.html" class="sidebar-item-text sidebar-link">Tidyverse</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./107-beyond_base_r.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">За пределами base R: tidyverse и data.table</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./110-tidyverse_basic.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Введение в tidyverse</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./120-tidyverse_advanced.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Продвинутый tidyverse</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./205-eda.html" class="sidebar-item-text sidebar-link">Разведочный анализ и создание отчетов</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./210-desc_stats.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Описательная статистика</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./220-base_viz.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Встроенные функции для графиков</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./230-ggplot2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Грамматика графики <code>ggplot2</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./240-dynamic_viz.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Динамические визуализации в R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./250-rmarkdown.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">R Markdown и Quarto</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./305-hyp_test.html" class="sidebar-item-text sidebar-link">Тестирование статистических гипотез</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./310-infer_stats.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Статистика вывода</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./320-ttest.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">t-тест</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./330-cov_cor.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Ковариация и корреляция</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./340-lm.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Линейная регрессия</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./350-anova.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Дисперсионный анализ (ANOVA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./360-glm.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Общая линейная модель и ее расширения</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./370-multivariate.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Многомерные методы анализа данных</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./410-planning.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Планирования научного исследования</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./905-tasks_solutions.html" class="sidebar-item-text sidebar-link">Задачник</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./910-tasks.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Задания</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./920-solutions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Решения заданий</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./950-references.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Библиография</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Содержание</h2>
   
  <ul>
  <li><a href="#sec-tidy_verse" id="toc-sec-tidy_verse" class="nav-link active" data-scroll-target="#sec-tidy_verse"><span class="toc-section-number">10.1</span>  Вселенная tidyverse</a></li>
  <li><a href="#загрузка-данных-с-помощью-readr" id="toc-загрузка-данных-с-помощью-readr" class="nav-link" data-scroll-target="#загрузка-данных-с-помощью-readr"><span class="toc-section-number">10.2</span>  Загрузка данных с помощью <code>readr</code></a></li>
  <li><a href="#sec-tibble" id="toc-sec-tibble" class="nav-link" data-scroll-target="#sec-tibble"><span class="toc-section-number">10.3</span>  tibble</a></li>
  <li><a href="#sec-pipe" id="toc-sec-pipe" class="nav-link" data-scroll-target="#sec-pipe"><span class="toc-section-number">10.4</span>  magrittr::<code>%&gt;%</code></a></li>
  <li><a href="#главные-пакеты-tidyverse-dplyr-и-tidyr" id="toc-главные-пакеты-tidyverse-dplyr-и-tidyr" class="nav-link" data-scroll-target="#главные-пакеты-tidyverse-dplyr-и-tidyr"><span class="toc-section-number">10.5</span>  Главные пакеты tidyverse: <code>dplyr</code> и <code>tidyr</code></a></li>
  <li><a href="#sec-tidy_select_cols" id="toc-sec-tidy_select_cols" class="nav-link" data-scroll-target="#sec-tidy_select_cols"><span class="toc-section-number">10.6</span>  Работа с колонками тиббла</a>
  <ul class="collapse">
  <li><a href="#выбор-колонок-dplyrselect" id="toc-выбор-колонок-dplyrselect" class="nav-link" data-scroll-target="#выбор-колонок-dplyrselect"><span class="toc-section-number">10.6.1</span>  Выбор колонок: <code>dplyr::select()</code></a></li>
  <li><a href="#sec-tidyselect" id="toc-sec-tidyselect" class="nav-link" data-scroll-target="#sec-tidyselect"><span class="toc-section-number">10.6.2</span>  Мини-язык tidyselect для выбора колонок</a></li>
  </ul></li>
  <li><a href="#sec-tidy_select_rows" id="toc-sec-tidy_select_rows" class="nav-link" data-scroll-target="#sec-tidy_select_rows"><span class="toc-section-number">10.7</span>  Работа со строками тиббла</a>
  <ul class="collapse">
  <li><a href="#sec-tidy_slice" id="toc-sec-tidy_slice" class="nav-link" data-scroll-target="#sec-tidy_slice"><span class="toc-section-number">10.7.1</span>  Выбор строк по номеру: <code>dplyr::slice()</code></a></li>
  <li><a href="#sec-tidy_filter" id="toc-sec-tidy_filter" class="nav-link" data-scroll-target="#sec-tidy_filter"><span class="toc-section-number">10.7.2</span>  Выбор строк по условию: <code>dplyr::filter()</code></a></li>
  <li><a href="#sec-slice_family" id="toc-sec-slice_family" class="nav-link" data-scroll-target="#sec-slice_family"><span class="toc-section-number">10.7.3</span>  Семейство функций <code>slice()</code></a></li>
  <li><a href="#sec-tidy_drop_na" id="toc-sec-tidy_drop_na" class="nav-link" data-scroll-target="#sec-tidy_drop_na"><span class="toc-section-number">10.7.4</span>  Удаление строчек с NA: <code>tidyr::drop_na()</code></a></li>
  <li><a href="#sec-tidy_arrange" id="toc-sec-tidy_arrange" class="nav-link" data-scroll-target="#sec-tidy_arrange"><span class="toc-section-number">10.7.5</span>  Сортировка строк: <code>dplyr::arrange()</code></a></li>
  </ul></li>
  <li><a href="#sec-tidy_mutate" id="toc-sec-tidy_mutate" class="nav-link" data-scroll-target="#sec-tidy_mutate"><span class="toc-section-number">10.8</span>  Создание колонок: <code>dplyr::mutate()</code> и <code>dplyr::transmute()</code></a></li>
  <li><a href="#sec-tidy_aggregate" id="toc-sec-tidy_aggregate" class="nav-link" data-scroll-target="#sec-tidy_aggregate"><span class="toc-section-number">10.9</span>  Агрегация данных в тиббле</a>
  <ul class="collapse">
  <li><a href="#sec-summarise" id="toc-sec-summarise" class="nav-link" data-scroll-target="#sec-summarise"><span class="toc-section-number">10.9.1</span>  Подытоживание: <code>summarise()</code></a></li>
  <li><a href="#sec-tidy_group" id="toc-sec-tidy_group" class="nav-link" data-scroll-target="#sec-tidy_group"><span class="toc-section-number">10.9.2</span>  Группировка: <code>group_by()</code></a></li>
  <li><a href="#sec-tidy_count" id="toc-sec-tidy_count" class="nav-link" data-scroll-target="#sec-tidy_count"><span class="toc-section-number">10.9.3</span>  Подсчет строк: <code>dplyr::n()</code>, <code>dplyr::count()</code></a></li>
  <li><a href="#sec-tidy_distinct" id="toc-sec-tidy_distinct" class="nav-link" data-scroll-target="#sec-tidy_distinct"><span class="toc-section-number">10.9.4</span>  Уникальные значения: <code>dplyr::distinct()</code></a></li>
  <li><a href="#sec-tidy_group_mutate" id="toc-sec-tidy_group_mutate" class="nav-link" data-scroll-target="#sec-tidy_group_mutate"><span class="toc-section-number">10.9.5</span>  Создание колонок с группировкой</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-tidy_intro" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Введение в tidyverse</span></span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Автор</div>
    <div class="quarto-title-meta-contents">
             <p>И.С. Поздняков <a href="https://orcid.org/0000-0002-2450-7004" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="sec-tidy_verse" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="sec-tidy_verse"><span class="header-section-number">10.1</span> Вселенная tidyverse</h2>
<p>tidyverse - это не один, а целое множество пакетов. Есть ключевые пакеты (ядро тайдиверса), а есть побочные - в основном для работы со специфическими видами данных.</p>
<p><a href="https://www.tidyverse.org"><em>tidyverse</em></a> — это набор пакетов:</p>
<ul>
<li><em>ggplot2</em>, для визуализации</li>
<li><em>tibble</em>, для работы с тибблами, продвинутый вариант датафрейма</li>
<li><em>tidyr</em>, для формата tidy data</li>
<li><em>readr</em>, для чтения файлов в R</li>
<li><em>purrr</em>, для функционального программирования (замена семейства функций *apply())</li>
<li><em>dplyr</em>, для преобразованиия данных</li>
<li><em>stringr</em>, для работы со строковыми переменными</li>
<li><em>forcats</em>, для работы с переменными-факторами</li>
</ul>
<p>Полезно также знать о следующих пакетах, не включенных в ядро, но также считающихся частью тайдиверса:</p>
<ul>
<li><em>vroom</em>, для быстрой загрузки табоичных данных</li>
<li><em>readxl</em>, для чтения .xls и .xlsx</li>
<li><em>jsonlite</em>, для работы с JSON</li>
<li><em>xml</em>, для работы с XML</li>
<li><em>DBI</em>, для работы с базами данных</li>
<li><em>rvest</em>, для веб-скреппинга</li>
<li><em>lubridate</em>, для работы с временем</li>
<li><em>tidytext</em>, для работы с текстами и корпусами</li>
<li><em>glue</em>, для продвинутого объединения строк</li>
<li><em>magrtittr</em>, с несколькими вариантами pipe оператора</li>
<li><em>tidymodels</em>, для моделирования и машинного обучения<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
<li><em>dtplyr</em>, для ускорения <code>dplyr</code> за счет перевод синтаксиса на <code>data.table</code></li>
</ul>
<p>И это еще не все пакеты tidyverse! Есть еще много других небольших пакетов, которые тоже считаются частью tidyverse. Кроме официальных пакетов tidyverse есть множество пакетов, которые пытаются соответствовать принципам tidyverse и дополняют его.</p>
<p>Все пакеты tidyverse объединены tidy философией и взаимосовместимым синтаксисом. Это означает, что, во многих случаях даже не нужно думать о том, из какого именно пакета тайдиверса пришла функция. Можно просто установить и загрузить пакет <code>tidyverse</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Пакет <code>tidyverse</code> — это такой <a href="https://cs11.pikabu.ru/post_img/big/2019/03/12/11/1552415351186680692.jpg">пакет с пакетами</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
✔ ggplot2 3.4.0     ✔ purrr   1.0.1
✔ tibble  3.1.8     ✔ dplyr   1.1.0
✔ tidyr   1.3.0     ✔ stringr 1.5.0
✔ readr   2.1.3     ✔ forcats 1.0.0
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
</div>
<p>Подключение пакета <code>tidyverse</code> автоматически приводит к подключению ядра tidyverse, остальные же пакеты нужно подключать дополнительно при необходимости.</p>
</section>
<section id="загрузка-данных-с-помощью-readr" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="загрузка-данных-с-помощью-readr"><span class="header-section-number">10.2</span> Загрузка данных с помощью <code>readr</code></h2>
<p>Стандартной функцией для чтения <code>.csv</code> файлов в R является функция <code>read.csv()</code>, но мы будем использовать функцию <code>read_csv()</code> из пакета <code>readr</code>. Синтаксис функции <code>read_csv()</code> очень похож на <code>read.csv()</code>: первым аргументом является путь к файлу (в том числе можно использовать URL), некоторые остальные параметры тоже совпадают.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/Pozdniakov/tidy_stats/master/data/heroes_information.csv"</span>,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">na =</span> <span class="fu">c</span>(<span class="st">"-"</span>, <span class="st">"-99"</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...1`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 734 Columns: 11
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (8): name, Gender, Eye color, Race, Hair color, Publisher, Skin color, A...
dbl (3): ...1, Height, Weight

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Подробнее про импорт данных, в том числе в tidyverse, смотри в @ref(real_data).</p>
</section>
<section id="sec-tibble" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="sec-tibble"><span class="header-section-number">10.3</span> tibble</h2>
<p>Когда мы загрузили данные с помощью <code>read_csv()</code>, то мы получили <code>tibble</code>, а не <code>data.frame</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(heroes)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "spec_tbl_df" "tbl_df"      "tbl"         "data.frame" </code></pre>
</div>
</div>
<p>Тиббл (<code>tibble</code>) - это такой “усовершенствованный” <code>data.frame</code>. <a href="https://www.jumpingrivers.com/blog/the-trouble-with-tibbles/">Почти</a> все, что работает с <code>data.frame</code>, работает и с тибблами. Однако у тибблов есть свои дополнительные фишки. Самая очевидная из них - более аккуратный вывод в консоль:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>heroes</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 11
    ...1 name        Gender Eye c…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵
   &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1     0 A-Bomb      Male   yellow  Human No Hair    203 Marvel… &lt;NA&gt;    good   
 2     1 Abe Sapien  Male   blue    Icth… No Hair    191 Dark H… blue    good   
 3     2 Abin Sur    Male   blue    Unga… No Hair    185 DC Com… red     good   
 4     3 Abomination Male   green   Huma… No Hair    203 Marvel… &lt;NA&gt;    bad    
 5     4 Abraxas     Male   blue    Cosm… Black       NA Marvel… &lt;NA&gt;    bad    
 6     5 Absorbing … Male   blue    Human No Hair    193 Marvel… &lt;NA&gt;    bad    
 7     6 Adam Monroe Male   blue    &lt;NA&gt;  Blond       NA NBC - … &lt;NA&gt;    good   
 8     7 Adam Stran… Male   blue    Human Blond      185 DC Com… &lt;NA&gt;    good   
 9     8 Agent 13    Female blue    &lt;NA&gt;  Blond      173 Marvel… &lt;NA&gt;    good   
10     9 Agent Bob   Male   brown   Human Brown      178 Marvel… &lt;NA&gt;    good   
# … with 724 more rows, 1 more variable: Weight &lt;dbl&gt;, and abbreviated variable
#   names ¹​`Eye color`, ²​`Hair color`, ³​Publisher, ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
<p>Выводятся только первые 10 строк, если какие-то колонки не влезают на экран, то они просто перечислены внизу. Ну а тип данных написан прямо под названием колонки.</p>
<p>Функции различных пакетов tidyverse сами конвертируют в тиббл при необходимости. Если же нужно это сделать самостоятельно, то можно это сделать так:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>heroes_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(heroes) <span class="co">#создаем простой датафрейм</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(heroes_df)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(heroes_df) <span class="co">#превращаем обратно в тиббл</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 11
    ...1 name        Gender Eye c…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵
   &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1     0 A-Bomb      Male   yellow  Human No Hair    203 Marvel… &lt;NA&gt;    good   
 2     1 Abe Sapien  Male   blue    Icth… No Hair    191 Dark H… blue    good   
 3     2 Abin Sur    Male   blue    Unga… No Hair    185 DC Com… red     good   
 4     3 Abomination Male   green   Huma… No Hair    203 Marvel… &lt;NA&gt;    bad    
 5     4 Abraxas     Male   blue    Cosm… Black       NA Marvel… &lt;NA&gt;    bad    
 6     5 Absorbing … Male   blue    Human No Hair    193 Marvel… &lt;NA&gt;    bad    
 7     6 Adam Monroe Male   blue    &lt;NA&gt;  Blond       NA NBC - … &lt;NA&gt;    good   
 8     7 Adam Stran… Male   blue    Human Blond      185 DC Com… &lt;NA&gt;    good   
 9     8 Agent 13    Female blue    &lt;NA&gt;  Blond      173 Marvel… &lt;NA&gt;    good   
10     9 Agent Bob   Male   brown   Human Brown      178 Marvel… &lt;NA&gt;    good   
# … with 724 more rows, 1 more variable: Weight &lt;dbl&gt;, and abbreviated variable
#   names ¹​`Eye color`, ²​`Hair color`, ³​Publisher, ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>В дальнейшем мы будем работать только с tidyverse, а это значит, что только с тибблами, а не обычными датафреймами. Тем не менее, тибблы и датафреймы будут в дальнейшем использоваться как синонимы.</p>
</blockquote>
<p>Можно создавать тибблы вручную с помощью функции <code>tibble()</code>, которая работает аналогично функции <code>data.frame()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">b =</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
      a b    
  &lt;int&gt; &lt;chr&gt;
1     1 a    
2     2 b    
3     3 c    </code></pre>
</div>
</div>
</section>
<section id="sec-pipe" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="sec-pipe"><span class="header-section-number">10.4</span> magrittr::<code>%&gt;%</code></h2>
<p>Оператор <code>%&gt;%</code> называется “пайпом” (pipe), т.е. “трубой”. Он означает, что следующая функция (справа от пайпа) принимает на вход в качестве первого аргумента результат выполнения предыдущей функции (той, что слева). Фактически, это примерно то же самое, что и вставлять результат выполнения функции в качестве первого аргумента в другую функцию. Просто выглядит это красивее и читабельнее. Как будто данные пропускаются через трубы функций или конвеерную ленту на заводе, если хотите. А то, что первый параметр функции - это почти всегда данные, работает нам здесь на руку. Этот оператор взят из пакета <code>magrittr</code><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. Возможно, даже если вы не захотите пользоваться tidyverse, использование пайпов Вам понравится.</p>
<p>Важно понимать, что пайп не дает какой-то дополнительной функциональности или дополнительной скорости работы<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Он создан исключительно для читабельности и комфорта.</p>
<p>С помощью пайпов вот эту команду…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">sqrt</span>(<span class="fu">abs</span>(<span class="fu">sin</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>))))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16.72656</code></pre>
</div>
</div>
<p>…можно переписать вот так:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">22</span> <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sin</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abs</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16.72656</code></pre>
</div>
</div>
<p><img src="images/morning_pipe.png" class="img-fluid" width="400"></p>
<p>В очень редких случаях результат выполнения функции нужно вставить не на первую позицию (или же мы хотим использовать его несколько раз). В этих случаях можно использовать <code>.</code>, чтобы обозначить, куда мы хотим вставить результат выполнения выражения слева от <code>%&gt;%</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="st">"Всем привет!"</span> <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"--"</span>, ., <span class="st">"--"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "--"           "Всем привет!" "--"          </code></pre>
</div>
</div>
<p>Основные функции в tidyverse …</p>
</section>
<section id="главные-пакеты-tidyverse-dplyr-и-tidyr" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="главные-пакеты-tidyverse-dplyr-и-tidyr"><span class="header-section-number">10.5</span> Главные пакеты tidyverse: <code>dplyr</code> и <code>tidyr</code></h2>
<p><code>dplyr</code><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> — это самая основа всего <code>tidyverse</code>. Этот пакет предоставляет основные функции для манипуляции с тибблами. Пакет <code>dplyr</code> является наследником и более усовершенствованной версией <code>plyr</code>, так что если увидите использование пакета <code>plyr</code>, то, скорее всего, скрипт был написан очень давно.</p>
<p>Пакет <code>tidyr</code> дополняет <code>dplyr</code>, предоставляя полезные функции для тайдификации тибблов. Тайдификация (“аккуратизация”) данных означает приведение табличных данных к такому формату, в котором:</p>
<ul>
<li>Каждая переменная имеет собственный столбец</li>
<li>Каждый наблюдение имеет собственную строку</li>
<li>Каждое значение имеет свою собственную ячейку</li>
</ul>
<p>Впрочем, многие функции <code>dplyr</code> часто используются при тайдификации, так же как и многие функции <code>tidyr</code> имеет применение вне тайдификации. В общем, функционал этих двух пакетов несколько смешался, поэтому мы будем рассматривать их вместе. А чтобы представлять, какая функция относится к какому пакету (хотя запоминать это необязательно), я буду использовать запись с двумя двоеточиями <code>::</code>, которая обычно используется для использования функции без подгрузки всего пакета, при первом упоминании функции.</p>
<p>Пакет <code>tidyr</code> — это более усовершенствованная версия пакета <code>reshape2</code>, который в свою очередь является усовершенствованной версией <code>reshape</code>. По аналогии с <code>plyr</code>, если вы видите использование этих пакетов, то это указывает на то, что перед вами морально устаревший код.</p>
<p>Код с использованием <code>dplyr</code> и <code>tidyr</code>сильно непохож на то, что мы видели раньше. Большинство функций <code>dplyr</code> и <code>tidyr</code> работают с целым тибблом сразу, принимая его в качестве первого аргумента и возвращая измененный тиббл. Это позволяет превратить весь код в последовательный набор применяемых функций, соединенный пайпами. На практике это выглядит очень элегантно, и вы в этом скоро убедитесь.</p>
</section>
<section id="sec-tidy_select_cols" class="level2" data-number="10.6">
<h2 data-number="10.6" class="anchored" data-anchor-id="sec-tidy_select_cols"><span class="header-section-number">10.6</span> Работа с колонками тиббла</h2>
<section id="выбор-колонок-dplyrselect" class="level3" data-number="10.6.1">
<h3 data-number="10.6.1" class="anchored" data-anchor-id="выбор-колонок-dplyrselect"><span class="header-section-number">10.6.1</span> Выбор колонок: <code>dplyr::select()</code></h3>
<p>Функция <code>dplyr::select()</code> позволяет выбирать колонки по номеру или имени (кавычки не нужны).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>,<span class="dv">5</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 2
    ...1 Race             
   &lt;dbl&gt; &lt;chr&gt;            
 1     0 Human            
 2     1 Icthyo Sapien    
 3     2 Ungaran          
 4     3 Human / Radiation
 5     4 Cosmic Entity    
 6     5 Human            
 7     6 &lt;NA&gt;             
 8     7 Human            
 9     8 &lt;NA&gt;             
10     9 Human            
# … with 724 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, Race, Publisher, <span class="st">`</span><span class="at">Hair color</span><span class="st">`</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 4
   name          Race              Publisher         `Hair color`
   &lt;chr&gt;         &lt;chr&gt;             &lt;chr&gt;             &lt;chr&gt;       
 1 A-Bomb        Human             Marvel Comics     No Hair     
 2 Abe Sapien    Icthyo Sapien     Dark Horse Comics No Hair     
 3 Abin Sur      Ungaran           DC Comics         No Hair     
 4 Abomination   Human / Radiation Marvel Comics     No Hair     
 5 Abraxas       Cosmic Entity     Marvel Comics     Black       
 6 Absorbing Man Human             Marvel Comics     No Hair     
 7 Adam Monroe   &lt;NA&gt;              NBC - Heroes      Blond       
 8 Adam Strange  Human             DC Comics         Blond       
 9 Agent 13      &lt;NA&gt;              Marvel Comics     Blond       
10 Agent Bob     Human             Marvel Comics     Brown       
# … with 724 more rows</code></pre>
</div>
</div>
<p>Обратите внимание, если в названии колонки присутствует пробел или, например, колонка начинается с цифры или точки и цифры, то это синтаксически невалидное имя (@ref(variables)). Это не значит, что такие названия колонок недопустимы. Но такие названия колонок нужно обособлять ` грависом (правый штрих, на клавиатуре находится там же где и буква ё и ~).</p>
<p>Еще обратите внимание на то, что функции tidyverse не изменяют сами изначальные тибблы/датафреймы. Это означает, что если вы хотите полученный результат сохранить, то нужно добавить присвоение:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>heroes_some_cols <span class="ot">&lt;-</span> heroes <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, Race, Publisher, <span class="st">`</span><span class="at">Hair color</span><span class="st">`</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>heroes_some_cols</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 4
   name          Race              Publisher         `Hair color`
   &lt;chr&gt;         &lt;chr&gt;             &lt;chr&gt;             &lt;chr&gt;       
 1 A-Bomb        Human             Marvel Comics     No Hair     
 2 Abe Sapien    Icthyo Sapien     Dark Horse Comics No Hair     
 3 Abin Sur      Ungaran           DC Comics         No Hair     
 4 Abomination   Human / Radiation Marvel Comics     No Hair     
 5 Abraxas       Cosmic Entity     Marvel Comics     Black       
 6 Absorbing Man Human             Marvel Comics     No Hair     
 7 Adam Monroe   &lt;NA&gt;              NBC - Heroes      Blond       
 8 Adam Strange  Human             DC Comics         Blond       
 9 Agent 13      &lt;NA&gt;              Marvel Comics     Blond       
10 Agent Bob     Human             Marvel Comics     Brown       
# … with 724 more rows</code></pre>
</div>
</div>
</section>
<section id="sec-tidyselect" class="level3" data-number="10.6.2">
<h3 data-number="10.6.2" class="anchored" data-anchor-id="sec-tidyselect"><span class="header-section-number">10.6.2</span> Мини-язык tidyselect для выбора колонок</h3>
<p>Для выбора столбцов (не только в <code>select()</code>, но и для других функций tidyverse) используется специальный мини-язык tidyselect из одноименного пакета<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. tidyselect дает очень широкие возможности для выбора колонок.</p>
<p>Можно использовать оператор <code>:</code> для выбора нескольких соседних колонок (по аналогии с созданием числового вектора с шагом 1).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name<span class="sc">:</span>Publisher)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 7
   name          Gender `Eye color` Race              Hair colo…¹ Height Publi…²
   &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;             &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;  
 1 A-Bomb        Male   yellow      Human             No Hair        203 Marvel…
 2 Abe Sapien    Male   blue        Icthyo Sapien     No Hair        191 Dark H…
 3 Abin Sur      Male   blue        Ungaran           No Hair        185 DC Com…
 4 Abomination   Male   green       Human / Radiation No Hair        203 Marvel…
 5 Abraxas       Male   blue        Cosmic Entity     Black           NA Marvel…
 6 Absorbing Man Male   blue        Human             No Hair        193 Marvel…
 7 Adam Monroe   Male   blue        &lt;NA&gt;              Blond           NA NBC - …
 8 Adam Strange  Male   blue        Human             Blond          185 DC Com…
 9 Agent 13      Female blue        &lt;NA&gt;              Blond          173 Marvel…
10 Agent Bob     Male   brown       Human             Brown          178 Marvel…
# … with 724 more rows, and abbreviated variable names ¹​`Hair color`,
#   ²​Publisher</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name<span class="sc">:</span><span class="st">`</span><span class="at">Eye color</span><span class="st">`</span>, Publisher<span class="sc">:</span>Weight)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 7
   name          Gender `Eye color` Publisher         Skin colo…¹ Align…² Weight
   &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;             &lt;chr&gt;       &lt;chr&gt;    &lt;dbl&gt;
 1 A-Bomb        Male   yellow      Marvel Comics     &lt;NA&gt;        good       441
 2 Abe Sapien    Male   blue        Dark Horse Comics blue        good        65
 3 Abin Sur      Male   blue        DC Comics         red         good        90
 4 Abomination   Male   green       Marvel Comics     &lt;NA&gt;        bad        441
 5 Abraxas       Male   blue        Marvel Comics     &lt;NA&gt;        bad         NA
 6 Absorbing Man Male   blue        Marvel Comics     &lt;NA&gt;        bad        122
 7 Adam Monroe   Male   blue        NBC - Heroes      &lt;NA&gt;        good        NA
 8 Adam Strange  Male   blue        DC Comics         &lt;NA&gt;        good        88
 9 Agent 13      Female blue        Marvel Comics     &lt;NA&gt;        good        61
10 Agent Bob     Male   brown       Marvel Comics     &lt;NA&gt;        good        81
# … with 724 more rows, and abbreviated variable names ¹​`Skin color`,
#   ²​Alignment</code></pre>
</div>
</div>
<p>Используя <code>!</code> можно вырезать ненужные колонки.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>...<span class="dv">1</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 10
   name       Gender Eye c…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵ Weight
   &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;
 1 A-Bomb     Male   yellow  Human No Hair    203 Marvel… &lt;NA&gt;    good       441
 2 Abe Sapien Male   blue    Icth… No Hair    191 Dark H… blue    good        65
 3 Abin Sur   Male   blue    Unga… No Hair    185 DC Com… red     good        90
 4 Abominati… Male   green   Huma… No Hair    203 Marvel… &lt;NA&gt;    bad        441
 5 Abraxas    Male   blue    Cosm… Black       NA Marvel… &lt;NA&gt;    bad         NA
 6 Absorbing… Male   blue    Human No Hair    193 Marvel… &lt;NA&gt;    bad        122
 7 Adam Monr… Male   blue    &lt;NA&gt;  Blond       NA NBC - … &lt;NA&gt;    good        NA
 8 Adam Stra… Male   blue    Human Blond      185 DC Com… &lt;NA&gt;    good        88
 9 Agent 13   Female blue    &lt;NA&gt;  Blond      173 Marvel… &lt;NA&gt;    good        61
10 Agent Bob  Male   brown   Human Brown      178 Marvel… &lt;NA&gt;    good        81
# … with 724 more rows, and abbreviated variable names ¹​`Eye color`,
#   ²​`Hair color`, ³​Publisher, ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>(Gender<span class="sc">:</span>Height))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 6
    ...1 name          Publisher         `Skin color` Alignment Weight
   &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;             &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt;
 1     0 A-Bomb        Marvel Comics     &lt;NA&gt;         good         441
 2     1 Abe Sapien    Dark Horse Comics blue         good          65
 3     2 Abin Sur      DC Comics         red          good          90
 4     3 Abomination   Marvel Comics     &lt;NA&gt;         bad          441
 5     4 Abraxas       Marvel Comics     &lt;NA&gt;         bad           NA
 6     5 Absorbing Man Marvel Comics     &lt;NA&gt;         bad          122
 7     6 Adam Monroe   NBC - Heroes      &lt;NA&gt;         good          NA
 8     7 Adam Strange  DC Comics         &lt;NA&gt;         good          88
 9     8 Agent 13      Marvel Comics     &lt;NA&gt;         good          61
10     9 Agent Bob     Marvel Comics     &lt;NA&gt;         good          81
# … with 724 more rows</code></pre>
</div>
</div>
<p>Другие известные нам логические операторы (<code>&amp;</code> и <code>|</code>) тоже работают в tidyselect.</p>
<p>В дополнение к логическим операторам и <code>:</code>, в tidyselect есть набор вспомогательных функций, работающих исключительно в контексте выбора колонок с помощью tidyselect.</p>
<p>Вспомогательная функция <code>last_col()</code> позволит обратиться к последней колонке тиббла:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name<span class="sc">:</span><span class="fu">last_col</span>())</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 10
   name       Gender Eye c…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵ Weight
   &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;
 1 A-Bomb     Male   yellow  Human No Hair    203 Marvel… &lt;NA&gt;    good       441
 2 Abe Sapien Male   blue    Icth… No Hair    191 Dark H… blue    good        65
 3 Abin Sur   Male   blue    Unga… No Hair    185 DC Com… red     good        90
 4 Abominati… Male   green   Huma… No Hair    203 Marvel… &lt;NA&gt;    bad        441
 5 Abraxas    Male   blue    Cosm… Black       NA Marvel… &lt;NA&gt;    bad         NA
 6 Absorbing… Male   blue    Human No Hair    193 Marvel… &lt;NA&gt;    bad        122
 7 Adam Monr… Male   blue    &lt;NA&gt;  Blond       NA NBC - … &lt;NA&gt;    good        NA
 8 Adam Stra… Male   blue    Human Blond      185 DC Com… &lt;NA&gt;    good        88
 9 Agent 13   Female blue    &lt;NA&gt;  Blond      173 Marvel… &lt;NA&gt;    good        61
10 Agent Bob  Male   brown   Human Brown      178 Marvel… &lt;NA&gt;    good        81
# … with 724 more rows, and abbreviated variable names ¹​`Eye color`,
#   ²​`Hair color`, ³​Publisher, ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
<p>А функция <code>everything()</code> позволяет выбрать все колонки.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">everything</span>())</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 11
    ...1 name        Gender Eye c…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵
   &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1     0 A-Bomb      Male   yellow  Human No Hair    203 Marvel… &lt;NA&gt;    good   
 2     1 Abe Sapien  Male   blue    Icth… No Hair    191 Dark H… blue    good   
 3     2 Abin Sur    Male   blue    Unga… No Hair    185 DC Com… red     good   
 4     3 Abomination Male   green   Huma… No Hair    203 Marvel… &lt;NA&gt;    bad    
 5     4 Abraxas     Male   blue    Cosm… Black       NA Marvel… &lt;NA&gt;    bad    
 6     5 Absorbing … Male   blue    Human No Hair    193 Marvel… &lt;NA&gt;    bad    
 7     6 Adam Monroe Male   blue    &lt;NA&gt;  Blond       NA NBC - … &lt;NA&gt;    good   
 8     7 Adam Stran… Male   blue    Human Blond      185 DC Com… &lt;NA&gt;    good   
 9     8 Agent 13    Female blue    &lt;NA&gt;  Blond      173 Marvel… &lt;NA&gt;    good   
10     9 Agent Bob   Male   brown   Human Brown      178 Marvel… &lt;NA&gt;    good   
# … with 724 more rows, 1 more variable: Weight &lt;dbl&gt;, and abbreviated variable
#   names ¹​`Eye color`, ²​`Hair color`, ³​Publisher, ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
<p>При этом <code>everything()</code> не будет дублировать выбранные колонки, поэтому можно использовать <code>everything()</code> для перестановки колонок в тиббле:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, Publisher, <span class="fu">everything</span>())</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 11
   name        Publi…¹  ...1 Gender Eye c…² Race  Hair …³ Height Skin …⁴ Align…⁵
   &lt;chr&gt;       &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  
 1 A-Bomb      Marvel…     0 Male   yellow  Human No Hair    203 &lt;NA&gt;    good   
 2 Abe Sapien  Dark H…     1 Male   blue    Icth… No Hair    191 blue    good   
 3 Abin Sur    DC Com…     2 Male   blue    Unga… No Hair    185 red     good   
 4 Abomination Marvel…     3 Male   green   Huma… No Hair    203 &lt;NA&gt;    bad    
 5 Abraxas     Marvel…     4 Male   blue    Cosm… Black       NA &lt;NA&gt;    bad    
 6 Absorbing … Marvel…     5 Male   blue    Human No Hair    193 &lt;NA&gt;    bad    
 7 Adam Monroe NBC - …     6 Male   blue    &lt;NA&gt;  Blond       NA &lt;NA&gt;    good   
 8 Adam Stran… DC Com…     7 Male   blue    Human Blond      185 &lt;NA&gt;    good   
 9 Agent 13    Marvel…     8 Female blue    &lt;NA&gt;  Blond      173 &lt;NA&gt;    good   
10 Agent Bob   Marvel…     9 Male   brown   Human Brown      178 &lt;NA&gt;    good   
# … with 724 more rows, 1 more variable: Weight &lt;dbl&gt;, and abbreviated variable
#   names ¹​Publisher, ²​`Eye color`, ³​`Hair color`, ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
<p>Впрочем, для перестановки колонок удобнее использовать специальную функцию <code>relocate()</code> (@ref(tidy_relocate)) Можно даже выбирать колонки по паттернам в названиях. Например, с помощью <code>ends_with()</code> можно выбрать все колонки, заканчивающиеся одинаковым суффиксом:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">"color"</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 3
   `Eye color` `Hair color` `Skin color`
   &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;       
 1 yellow      No Hair      &lt;NA&gt;        
 2 blue        No Hair      blue        
 3 blue        No Hair      red         
 4 green       No Hair      &lt;NA&gt;        
 5 blue        Black        &lt;NA&gt;        
 6 blue        No Hair      &lt;NA&gt;        
 7 blue        Blond        &lt;NA&gt;        
 8 blue        Blond        &lt;NA&gt;        
 9 blue        Blond        &lt;NA&gt;        
10 brown       Brown        &lt;NA&gt;        
# … with 724 more rows</code></pre>
</div>
</div>
<p>Аналогично, с помощью функции <code>starts_with()</code> можно найти колонки с одинаковым префиксом, с помощью <code>contains()</code> — все колонки с выбранным паттерном в любой части названия колонки<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"Eye"</span>) <span class="sc">&amp;</span> <span class="fu">ends_with</span>(<span class="st">"color"</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 1
   `Eye color`
   &lt;chr&gt;      
 1 yellow     
 2 blue       
 3 blue       
 4 green      
 5 blue       
 6 blue       
 7 blue       
 8 blue       
 9 blue       
10 brown      
# … with 724 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"eight"</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 2
   Height Weight
    &lt;dbl&gt;  &lt;dbl&gt;
 1    203    441
 2    191     65
 3    185     90
 4    203    441
 5     NA     NA
 6    193    122
 7     NA     NA
 8    185     88
 9    173     61
10    178     81
# … with 724 more rows</code></pre>
</div>
</div>
<p>Ну и наконец, можно выбирать по содержимому колонок с помощью <code>where()</code>. Это напоминает применение <code>sapply()</code>(@ref(apply_other)) на датафрейме для индексирования колонок: в качестве аргумента для <code>where</code> принимается функция, которая применяется для каждой из колонок, после чего выбираются только те колонки, для которых было получено <code>TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 3
    ...1 Height Weight
   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1     0    203    441
 2     1    191     65
 3     2    185     90
 4     3    203    441
 5     4     NA     NA
 6     5    193    122
 7     6     NA     NA
 8     7    185     88
 9     8    173     61
10     9    178     81
# … with 724 more rows</code></pre>
</div>
</div>
<p>Функция <code>where()</code> дает невиданную мощь. Например, можно выбрать все колонки без <code>NA</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(<span class="cf">function</span>(x) <span class="sc">!</span><span class="fu">any</span>(<span class="fu">is.na</span>(x))))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 3
    ...1 name          Publisher        
   &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;            
 1     0 A-Bomb        Marvel Comics    
 2     1 Abe Sapien    Dark Horse Comics
 3     2 Abin Sur      DC Comics        
 4     3 Abomination   Marvel Comics    
 5     4 Abraxas       Marvel Comics    
 6     5 Absorbing Man Marvel Comics    
 7     6 Adam Monroe   NBC - Heroes     
 8     7 Adam Strange  DC Comics        
 9     8 Agent 13      Marvel Comics    
10     9 Agent Bob     Marvel Comics    
# … with 724 more rows</code></pre>
</div>
</div>
<p>###Переименование колонок: <code>dplyr::rename()</code></p>
<p>Внутри <code>select()</code> можно не только выбирать колонки, но и переименовывать их:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">id =</span> ...<span class="dv">1</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 1
      id
   &lt;dbl&gt;
 1     0
 2     1
 3     2
 4     3
 5     4
 6     5
 7     6
 8     7
 9     8
10     9
# … with 724 more rows</code></pre>
</div>
</div>
<p>Однако удобнее для этого использовать специальную функцию <code>dplyr::rename()</code>. Синтаксис у нее такой же, как и у <code>select()</code>, но <code>rename()</code> не выбрасывает колонки, которые не были упомянуты.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">id =</span> ...<span class="dv">1</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 11
      id name        Gender Eye c…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵
   &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1     0 A-Bomb      Male   yellow  Human No Hair    203 Marvel… &lt;NA&gt;    good   
 2     1 Abe Sapien  Male   blue    Icth… No Hair    191 Dark H… blue    good   
 3     2 Abin Sur    Male   blue    Unga… No Hair    185 DC Com… red     good   
 4     3 Abomination Male   green   Huma… No Hair    203 Marvel… &lt;NA&gt;    bad    
 5     4 Abraxas     Male   blue    Cosm… Black       NA Marvel… &lt;NA&gt;    bad    
 6     5 Absorbing … Male   blue    Human No Hair    193 Marvel… &lt;NA&gt;    bad    
 7     6 Adam Monroe Male   blue    &lt;NA&gt;  Blond       NA NBC - … &lt;NA&gt;    good   
 8     7 Adam Stran… Male   blue    Human Blond      185 DC Com… &lt;NA&gt;    good   
 9     8 Agent 13    Female blue    &lt;NA&gt;  Blond      173 Marvel… &lt;NA&gt;    good   
10     9 Agent Bob   Male   brown   Human Brown      178 Marvel… &lt;NA&gt;    good   
# … with 724 more rows, 1 more variable: Weight &lt;dbl&gt;, and abbreviated variable
#   names ¹​`Eye color`, ²​`Hair color`, ³​Publisher, ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
<p>Для массового переименования колонок можно использовать функцию <code>rename_with()</code>. Эта функция так же использует tidyselect синтаксис для выбора колонок (по умолчанию выбираются все колонки) и применяет функцию в качестве аргумента, которая изменяет</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(make.names)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 11
    ...1 name        Gender Eye.c…¹ Race  Hair.…² Height Publi…³ Skin.…⁴ Align…⁵
   &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1     0 A-Bomb      Male   yellow  Human No Hair    203 Marvel… &lt;NA&gt;    good   
 2     1 Abe Sapien  Male   blue    Icth… No Hair    191 Dark H… blue    good   
 3     2 Abin Sur    Male   blue    Unga… No Hair    185 DC Com… red     good   
 4     3 Abomination Male   green   Huma… No Hair    203 Marvel… &lt;NA&gt;    bad    
 5     4 Abraxas     Male   blue    Cosm… Black       NA Marvel… &lt;NA&gt;    bad    
 6     5 Absorbing … Male   blue    Human No Hair    193 Marvel… &lt;NA&gt;    bad    
 7     6 Adam Monroe Male   blue    &lt;NA&gt;  Blond       NA NBC - … &lt;NA&gt;    good   
 8     7 Adam Stran… Male   blue    Human Blond      185 DC Com… &lt;NA&gt;    good   
 9     8 Agent 13    Female blue    &lt;NA&gt;  Blond      173 Marvel… &lt;NA&gt;    good   
10     9 Agent Bob   Male   brown   Human Brown      178 Marvel… &lt;NA&gt;    good   
# … with 724 more rows, 1 more variable: Weight &lt;dbl&gt;, and abbreviated variable
#   names ¹​Eye.color, ²​Hair.color, ³​Publisher, ⁴​Skin.color, ⁵​Alignment</code></pre>
</div>
</div>
<p>###Перестановка колонок: <code>dplyr::relocate()</code> {#sec-tidy_relocate}</p>
<p>Для изменения порядка колонок можно использовать функцию <code>relocate()</code>. Она тоже работает похожим образом на <code>select()</code> и <code>rename()</code><a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>. Как и <code>rename()</code>, функция <code>relocate()</code> не выкидывает неиспользованные колонки:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(Publisher)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 11
   Publisher      ...1 name  Gender Eye c…¹ Race  Hair …² Height Skin …³ Align…⁴
   &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  
 1 Marvel Comics     0 A-Bo… Male   yellow  Human No Hair    203 &lt;NA&gt;    good   
 2 Dark Horse C…     1 Abe … Male   blue    Icth… No Hair    191 blue    good   
 3 DC Comics         2 Abin… Male   blue    Unga… No Hair    185 red     good   
 4 Marvel Comics     3 Abom… Male   green   Huma… No Hair    203 &lt;NA&gt;    bad    
 5 Marvel Comics     4 Abra… Male   blue    Cosm… Black       NA &lt;NA&gt;    bad    
 6 Marvel Comics     5 Abso… Male   blue    Human No Hair    193 &lt;NA&gt;    bad    
 7 NBC - Heroes      6 Adam… Male   blue    &lt;NA&gt;  Blond       NA &lt;NA&gt;    good   
 8 DC Comics         7 Adam… Male   blue    Human Blond      185 &lt;NA&gt;    good   
 9 Marvel Comics     8 Agen… Female blue    &lt;NA&gt;  Blond      173 &lt;NA&gt;    good   
10 Marvel Comics     9 Agen… Male   brown   Human Brown      178 &lt;NA&gt;    good   
# … with 724 more rows, 1 more variable: Weight &lt;dbl&gt;, and abbreviated variable
#   names ¹​`Eye color`, ²​`Hair color`, ³​`Skin color`, ⁴​Alignment</code></pre>
</div>
</div>
<p>При этом <code>relocate()</code> имеет дополнительные параметры <code>.after =</code> и <code>.before =</code>, которые позволяют выбирать, куда поместить выбранные колонки.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(Publisher, <span class="at">.after =</span> name)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 11
    ...1 name        Publi…¹ Gender Eye c…² Race  Hair …³ Height Skin …⁴ Align…⁵
   &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  
 1     0 A-Bomb      Marvel… Male   yellow  Human No Hair    203 &lt;NA&gt;    good   
 2     1 Abe Sapien  Dark H… Male   blue    Icth… No Hair    191 blue    good   
 3     2 Abin Sur    DC Com… Male   blue    Unga… No Hair    185 red     good   
 4     3 Abomination Marvel… Male   green   Huma… No Hair    203 &lt;NA&gt;    bad    
 5     4 Abraxas     Marvel… Male   blue    Cosm… Black       NA &lt;NA&gt;    bad    
 6     5 Absorbing … Marvel… Male   blue    Human No Hair    193 &lt;NA&gt;    bad    
 7     6 Adam Monroe NBC - … Male   blue    &lt;NA&gt;  Blond       NA &lt;NA&gt;    good   
 8     7 Adam Stran… DC Com… Male   blue    Human Blond      185 &lt;NA&gt;    good   
 9     8 Agent 13    Marvel… Female blue    &lt;NA&gt;  Blond      173 &lt;NA&gt;    good   
10     9 Agent Bob   Marvel… Male   brown   Human Brown      178 &lt;NA&gt;    good   
# … with 724 more rows, 1 more variable: Weight &lt;dbl&gt;, and abbreviated variable
#   names ¹​Publisher, ²​`Eye color`, ³​`Hair color`, ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
<p><code>relocate()</code> очень хорошо работает в сочетании с выбором колонок с помощью tidyselect. Например, можно передвинуть в одно место все колонки с одним типом данных:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(Publisher, <span class="fu">where</span>(is.numeric), <span class="at">.after =</span> name)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 11
   name         Publi…¹  ...1 Height Weight Gender Eye c…² Race  Hair …³ Skin …⁴
   &lt;chr&gt;        &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  
 1 A-Bomb       Marvel…     0    203    441 Male   yellow  Human No Hair &lt;NA&gt;   
 2 Abe Sapien   Dark H…     1    191     65 Male   blue    Icth… No Hair blue   
 3 Abin Sur     DC Com…     2    185     90 Male   blue    Unga… No Hair red    
 4 Abomination  Marvel…     3    203    441 Male   green   Huma… No Hair &lt;NA&gt;   
 5 Abraxas      Marvel…     4     NA     NA Male   blue    Cosm… Black   &lt;NA&gt;   
 6 Absorbing M… Marvel…     5    193    122 Male   blue    Human No Hair &lt;NA&gt;   
 7 Adam Monroe  NBC - …     6     NA     NA Male   blue    &lt;NA&gt;  Blond   &lt;NA&gt;   
 8 Adam Strange DC Com…     7    185     88 Male   blue    Human Blond   &lt;NA&gt;   
 9 Agent 13     Marvel…     8    173     61 Female blue    &lt;NA&gt;  Blond   &lt;NA&gt;   
10 Agent Bob    Marvel…     9    178     81 Male   brown   Human Brown   &lt;NA&gt;   
# … with 724 more rows, 1 more variable: Alignment &lt;chr&gt;, and abbreviated
#   variable names ¹​Publisher, ²​`Eye color`, ³​`Hair color`, ⁴​`Skin color`</code></pre>
</div>
</div>
<p>Последняя важная функция для выбора колонок — <code>pull()</code>. Эта функция делает то же самое, что и индексирование с помощью <code>$</code>, т.е. вытаскивает из тиббла вектор с выбранным названием. Это лучше вписывается в логику tidyverse, поскольку позволяет извлечь колонку из тиббла с использованием пайпа:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Height) <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 203 191 185 203  NA 193</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Height) <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 203 191 185 203  NA 193</code></pre>
</div>
</div>
<p>У функции <code>pull()</code> есть аргумент <code>name =</code>, который позволяет создать проименованный вектор:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Height, name) <span class="sc">%&gt;%</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       A-Bomb    Abe Sapien      Abin Sur   Abomination       Abraxas 
          203           191           185           203            NA 
Absorbing Man 
          193 </code></pre>
</div>
</div>
<p>В отличие от базового R, tidyverse нигде не сокращает имплицитно результат вычислений до вектора, поэтому функция <code>pull()</code> - это основной способ извлечения колонки из тиббла как вектора.</p>
</section>
</section>
<section id="sec-tidy_select_rows" class="level2" data-number="10.7">
<h2 data-number="10.7" class="anchored" data-anchor-id="sec-tidy_select_rows"><span class="header-section-number">10.7</span> Работа со строками тиббла</h2>
<section id="sec-tidy_slice" class="level3" data-number="10.7.1">
<h3 data-number="10.7.1" class="anchored" data-anchor-id="sec-tidy_slice"><span class="header-section-number">10.7.1</span> Выбор строк по номеру: <code>dplyr::slice()</code></h3>
<p>Начнем с выбора строк. Функция <code>dplyr::slice()</code> выбирает строчки по их числовому индексу.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
   ...1 name  Gender Eye c…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵ Weight
  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;
1     0 A-Bo… Male   yellow  Human No Hair    203 Marvel… &lt;NA&gt;    good       441
2     1 Abe … Male   blue    Icth… No Hair    191 Dark H… blue    good        65
3     2 Abin… Male   blue    Unga… No Hair    185 DC Com… red     good        90
# … with abbreviated variable names ¹​`Eye color`, ²​`Hair color`, ³​Publisher,
#   ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
</section>
<section id="sec-tidy_filter" class="level3" data-number="10.7.2">
<h3 data-number="10.7.2" class="anchored" data-anchor-id="sec-tidy_filter"><span class="header-section-number">10.7.2</span> Выбор строк по условию: <code>dplyr::filter()</code></h3>
<p>Функция <code>dplyr::filter()</code> делает то же самое, что и <code>slice()</code>, но уже по условию. Причем для условий нужно использовать не векторы из тиббла, а название колонок (без кавычек) как будто бы они были переменными в окружении.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Publisher <span class="sc">==</span> <span class="st">"DC Comics"</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 215 × 11
    ...1 name        Gender Eye c…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵
   &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1     2 Abin Sur    Male   blue    Unga… No Hair    185 DC Com… red     good   
 2     7 Adam Stran… Male   blue    Human Blond      185 DC Com… &lt;NA&gt;    good   
 3    13 Alan Scott  Male   blue    &lt;NA&gt;  Blond      180 DC Com… &lt;NA&gt;    good   
 4    16 Alfred Pen… Male   blue    Human Black      178 DC Com… &lt;NA&gt;    good   
 5    19 Amazo       Male   red     Andr… &lt;NA&gt;       257 DC Com… &lt;NA&gt;    bad    
 6    27 Animal Man  Male   blue    Human Blond      183 DC Com… &lt;NA&gt;    good   
 7    31 Anti-Monit… Male   yellow  God … No Hair     61 DC Com… &lt;NA&gt;    bad    
 8    35 Aquababy    Male   blue    &lt;NA&gt;  Blond       NA DC Com… &lt;NA&gt;    good   
 9    36 Aqualad     Male   blue    Atla… Black      178 DC Com… &lt;NA&gt;    good   
10    37 Aquaman     Male   blue    Atla… Blond      185 DC Com… &lt;NA&gt;    good   
# … with 205 more rows, 1 more variable: Weight &lt;dbl&gt;, and abbreviated variable
#   names ¹​`Eye color`, ²​`Hair color`, ³​Publisher, ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
</section>
<section id="sec-slice_family" class="level3" data-number="10.7.3">
<h3 data-number="10.7.3" class="anchored" data-anchor-id="sec-slice_family"><span class="header-section-number">10.7.3</span> Семейство функций <code>slice()</code></h3>
<p>У функции <code>slice()</code> есть множество родственников, которые объединяют функционал обычного <code>slice()</code> и <code>filter()</code>. Например, с помощью функций <code>dplyr::slice_max()</code> и <code>dplyr::slice_min()</code> можно выбрать заданное количество строк, содержащих наибольшие или наименьшие значения по колонке соответственно:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(Weight, <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
   ...1 name  Gender Eye c…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵ Weight
  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;
1   575 Sasq… Male   red     &lt;NA&gt;  Orange     305 Marvel… &lt;NA&gt;    good       900
2   373 Jugg… Male   blue    Human Red        287 Marvel… &lt;NA&gt;    neutral    855
3   203 Dark… Male   red     New … No Hair    267 DC Com… grey    bad        817
# … with abbreviated variable names ¹​`Eye color`, ²​`Hair color`, ³​Publisher,
#   ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(Weight, <span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
   ...1 name  Gender Eye c…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵ Weight
  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;
1   346 Iron… Male   blue    &lt;NA&gt;  No Hair     NA Marvel… &lt;NA&gt;    bad          2
2   302 Groot Male   yellow  Flor… &lt;NA&gt;       701 Marvel… &lt;NA&gt;    good         4
3   350 Jack… Male   blue    Human Brown       71 Dark H… &lt;NA&gt;    good        14
# … with abbreviated variable names ¹​`Eye color`, ²​`Hair color`, ³​Publisher,
#   ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
<p>Функция <code>slice_sample()</code> позволяет выбирать заданное количество случайных строчек:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">3</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 11
   ...1 name  Gender Eye c…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵ Weight
  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;
1   497 Nova  Female white   Huma… Red        163 Marvel… gold    good        59
2   668 Tige… Male   grey    Human No Hair    185 Marvel… grey    bad        203
3    42 Ares  Male   brown   &lt;NA&gt;  Brown      185 Marvel… &lt;NA&gt;    good       270
# … with abbreviated variable names ¹​`Eye color`, ²​`Hair color`, ³​Publisher,
#   ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
<p>Или же долю строчек:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">prop =</span> .<span class="dv">01</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 11
   ...1 name  Gender Eye c…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵ Weight
  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;
1   224 Doct… Male   brown   Human Brown      175 Marvel… &lt;NA&gt;    bad        110
2    57 Azra… Male   brown   Human Black       NA DC Com… &lt;NA&gt;    good        NA
3   465 Mohi… Male   &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;        NA NBC - … &lt;NA&gt;    good        NA
4   342 Ink   Male   blue    Muta… No Hair    180 Marvel… &lt;NA&gt;    good        81
5   472 Morl… Male   white … &lt;NA&gt;  Black      188 Marvel… &lt;NA&gt;    bad         79
6   112 Blaq… &lt;NA&gt;   black   &lt;NA&gt;  No Hair     NA Marvel… &lt;NA&gt;    good        NA
7   261 Fixer &lt;NA&gt;   red     &lt;NA&gt;  No Hair     NA Marvel… &lt;NA&gt;    bad         NA
# … with abbreviated variable names ¹​`Eye color`, ²​`Hair color`, ³​Publisher,
#   ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
<p>Если поставить значение параметра <code>prop =</code> равным <code>1</code>, то таким образом можно перемешать порядок строчек в тиббле:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="dv">1</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 11
    ...1 name        Gender Eye c…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵
   &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1   229 Doomsday    Male   red     Alien White      244 DC Com… &lt;NA&gt;    bad    
 2   644 Superboy-P… Male   blue    Kryp… Black …    180 DC Com… &lt;NA&gt;    bad    
 3   468 Monarch     Male   blue    &lt;NA&gt;  White      193 DC Com… &lt;NA&gt;    good   
 4   498 Odin        Male   blue    God … White      206 Marvel… &lt;NA&gt;    good   
 5   527 Predator    Male   &lt;NA&gt;    Yaut… &lt;NA&gt;       213 Dark H… &lt;NA&gt;    bad    
 6   173 Cheetah III Female brown   Human Brown      175 DC Com… &lt;NA&gt;    bad    
 7   187 Cottonmouth Male   brown   Human Black      183 Marvel… &lt;NA&gt;    bad    
 8     2 Abin Sur    Male   blue    Unga… No Hair    185 DC Com… red     good   
 9   342 Ink         Male   blue    Muta… No Hair    180 Marvel… &lt;NA&gt;    good   
10   266 Flash IV    Male   yellow  Human Auburn     157 DC Com… &lt;NA&gt;    good   
# … with 724 more rows, 1 more variable: Weight &lt;dbl&gt;, and abbreviated variable
#   names ¹​`Eye color`, ²​`Hair color`, ³​Publisher, ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
</section>
<section id="sec-tidy_drop_na" class="level3" data-number="10.7.4">
<h3 data-number="10.7.4" class="anchored" data-anchor-id="sec-tidy_drop_na"><span class="header-section-number">10.7.4</span> Удаление строчек с NA: <code>tidyr::drop_na()</code></h3>
<p>Если нужно выбрать только строчки без пропущенных значений, то можно воспользоваться удобной функцией <code>tidyr::drop_na()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 11
    ...1 name       Gender Eye co…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵
   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1     1 Abe Sapien Male   blue     Icth… No Hair    191 Dark H… blue    good   
 2     2 Abin Sur   Male   blue     Unga… No Hair    185 DC Com… red     good   
 3    34 Apocalypse Male   red      Muta… Black      213 Marvel… grey    bad    
 4    39 Archangel  Male   blue     Muta… Blond      183 Marvel… blue    good   
 5    41 Ardina     Female white    Alien Orange     193 Marvel… gold    good   
 6    56 Azazel     Male   yellow   Neya… Black      183 Marvel… red     bad    
 7    74 Beast      Male   blue     Muta… Blue       180 Marvel… blue    good   
 8    75 Beast Boy  Male   green    Human Green      173 DC Com… green   good   
 9    92 Bizarro    Male   black    Biza… Black      191 DC Com… white   neutral
10   108 Blackout   Male   red      Demon White      191 Marvel… white   bad    
# … with 40 more rows, 1 more variable: Weight &lt;dbl&gt;, and abbreviated variable
#   names ¹​`Eye color`, ²​`Hair color`, ³​Publisher, ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
<p>Можно выбрать колонки, наличие <code>NA</code> в которых будет приводить к удалению соответствующих строчек (не затрагивая другие строчки, в которых есть <code>NA</code> в остальных столбцах).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(Weight)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 495 × 11
    ...1 name        Gender Eye c…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵
   &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1     0 A-Bomb      Male   yellow  Human No Hair    203 Marvel… &lt;NA&gt;    good   
 2     1 Abe Sapien  Male   blue    Icth… No Hair    191 Dark H… blue    good   
 3     2 Abin Sur    Male   blue    Unga… No Hair    185 DC Com… red     good   
 4     3 Abomination Male   green   Huma… No Hair    203 Marvel… &lt;NA&gt;    bad    
 5     5 Absorbing … Male   blue    Human No Hair    193 Marvel… &lt;NA&gt;    bad    
 6     7 Adam Stran… Male   blue    Human Blond      185 DC Com… &lt;NA&gt;    good   
 7     8 Agent 13    Female blue    &lt;NA&gt;  Blond      173 Marvel… &lt;NA&gt;    good   
 8     9 Agent Bob   Male   brown   Human Brown      178 Marvel… &lt;NA&gt;    good   
 9    10 Agent Zero  Male   &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;       191 Marvel… &lt;NA&gt;    good   
10    11 Air-Walker  Male   blue    &lt;NA&gt;  White      188 Marvel… &lt;NA&gt;    bad    
# … with 485 more rows, 1 more variable: Weight &lt;dbl&gt;, and abbreviated variable
#   names ¹​`Eye color`, ²​`Hair color`, ³​Publisher, ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
<p>Для выбора колонок в <code>drop_na()</code> используется tidyselect, с которым мы недавно познакомились (@ref(tidyselect)).</p>
</section>
<section id="sec-tidy_arrange" class="level3" data-number="10.7.5">
<h3 data-number="10.7.5" class="anchored" data-anchor-id="sec-tidy_arrange"><span class="header-section-number">10.7.5</span> Сортировка строк: <code>dplyr::arrange()</code></h3>
<p>Функция <code>dplyr::arrange()</code> сортирует строчки от меньшего к большему (или по алфавиту - для текстовых значений) по выбранной колонке.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Weight)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 11
    ...1 name        Gender Eye c…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵
   &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1   346 Iron Monger Male   blue    &lt;NA&gt;  No Hair     NA Marvel… &lt;NA&gt;    bad    
 2   302 Groot       Male   yellow  Flor… &lt;NA&gt;       701 Marvel… &lt;NA&gt;    good   
 3   350 Jack-Jack   Male   blue    Human Brown       71 Dark H… &lt;NA&gt;    good   
 4   272 Galactus    Male   black   Cosm… Black      876 Marvel… &lt;NA&gt;    neutral
 5   731 Yoda        Male   brown   Yoda… White       66 George… green   good   
 6   255 Fin Fang F… Male   red     Kaka… No Hair    975 Marvel… green   good   
 7   330 Howard the… Male   brown   &lt;NA&gt;  Yellow      79 Marvel… &lt;NA&gt;    good   
 8   396 Krypto      Male   blue    Kryp… White       64 DC Com… &lt;NA&gt;    good   
 9   568 Rocket Rac… Male   brown   Anim… Brown      122 Marvel… &lt;NA&gt;    good   
10   208 Dash        Male   blue    Human Blond      122 Dark H… &lt;NA&gt;    good   
# … with 724 more rows, 1 more variable: Weight &lt;dbl&gt;, and abbreviated variable
#   names ¹​`Eye color`, ²​`Hair color`, ³​Publisher, ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
<p>Чтобы отсортировать в обратном порядке, воспользуйтесь функцией <code>desc()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Weight))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 11
    ...1 name       Gender Eye co…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵
   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1   575 Sasquatch  Male   red      &lt;NA&gt;  Orange   305   Marvel… &lt;NA&gt;    good   
 2   373 Juggernaut Male   blue     Human Red      287   Marvel… &lt;NA&gt;    neutral
 3   203 Darkseid   Male   red      New … No Hair  267   DC Com… grey    bad    
 4   283 Giganta    Female green    &lt;NA&gt;  Red       62.5 DC Com… &lt;NA&gt;    bad    
 5   331 Hulk       Male   green    Huma… Green    244   Marvel… green   good   
 6   549 Red Hulk   Male   yellow   Huma… Black    213   Marvel… red     neutral
 7   119 Bloodaxe   Female blue     Human Brown    218   Marvel… &lt;NA&gt;    bad    
 8   718 Wolfsbane  Female green    &lt;NA&gt;  Auburn   366   Marvel… &lt;NA&gt;    good   
 9   657 Thanos     Male   red      Eter… No Hair  201   Marvel… purple  bad    
10     0 A-Bomb     Male   yellow   Human No Hair  203   Marvel… &lt;NA&gt;    good   
# … with 724 more rows, 1 more variable: Weight &lt;dbl&gt;, and abbreviated variable
#   names ¹​`Eye color`, ²​`Hair color`, ³​Publisher, ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
<p>Можно сортировать по нескольким колонкам сразу. В таких случаях удобно в качестве первой переменной выбирать переменную, обозначающую принадлежность к группе, а в качестве второй — континуальную числовую переменную:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Gender, <span class="fu">desc</span>(Weight))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 11
    ...1 name      Gender Eye col…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵
   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1   283 Giganta   Female green     &lt;NA&gt;  Red       62.5 DC Com… &lt;NA&gt;    bad    
 2   119 Bloodaxe  Female blue      Human Brown    218   Marvel… &lt;NA&gt;    bad    
 3   718 Wolfsbane Female green     &lt;NA&gt;  Auburn   366   Marvel… &lt;NA&gt;    good   
 4   591 She-Hulk  Female green     Human Green    201   Marvel… &lt;NA&gt;    good   
 5   320 Hela      Female green     Asga… Black    213   Marvel… &lt;NA&gt;    bad    
 6   686 Valkyrie  Female blue      &lt;NA&gt;  Blond    191   Marvel… &lt;NA&gt;    good   
 7   596 Sif       Female blue      Asga… Black    188   Marvel… &lt;NA&gt;    good   
 8   271 Frigga    Female blue      &lt;NA&gt;  White    180   Marvel… &lt;NA&gt;    good   
 9   667 Thundra   Female green     &lt;NA&gt;  Red      218   Marvel… &lt;NA&gt;    good   
10   592 She-Thing Female blue      Huma… No Hair  183   Marvel… &lt;NA&gt;    good   
# … with 724 more rows, 1 more variable: Weight &lt;dbl&gt;, and abbreviated variable
#   names ¹​`Eye color`, ²​`Hair color`, ³​Publisher, ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-tidy_mutate" class="level2" data-number="10.8">
<h2 data-number="10.8" class="anchored" data-anchor-id="sec-tidy_mutate"><span class="header-section-number">10.8</span> Создание колонок: <code>dplyr::mutate()</code> и <code>dplyr::transmute()</code></h2>
<p>Функция <code>dplyr::mutate()</code> позволяет создавать новые колонки в тиббле.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">imt =</span> Weight<span class="sc">/</span>(Height<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, imt) <span class="sc">%&gt;%</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(imt))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 2
   name          imt
   &lt;chr&gt;       &lt;dbl&gt;
 1 Utgard-Loki 2510.
 2 Giganta     1613.
 3 Red Hulk     139.
 4 Darkseid     115.
 5 Machine Man  114.
 6 Thanos       110.
 7 Destroyer    108.
 8 A-Bomb       107.
 9 Abomination  107.
10 Hulk         106.
# … with 724 more rows</code></pre>
</div>
</div>
<p><code>dplyr::transmute()</code> - это аналог <code>mutate()</code>, который не только создает новые колонки, но и сразу же выкидывает все старые:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">imt =</span> Weight<span class="sc">/</span>(Height<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 1
     imt
   &lt;dbl&gt;
 1 107. 
 2  17.8
 3  26.3
 4 107. 
 5  NA  
 6  32.8
 7  NA  
 8  25.7
 9  20.4
10  25.6
# … with 724 more rows</code></pre>
</div>
</div>
<p>Внутри <code>mutate()</code> и <code>transmute()</code> мы можем использовать либо векторизованные операции (длина новой колонки должна равняться длине датафрейма), либо операции, которые возвращают одно значение. В последнем случае значение будет одинаковым на всю колонку, т.е. будет работать правило ресайклинга (@ref(recycling)):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(name, <span class="at">weight_mean =</span> <span class="fu">mean</span>(Weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 2
   name          weight_mean
   &lt;chr&gt;               &lt;dbl&gt;
 1 A-Bomb               112.
 2 Abe Sapien           112.
 3 Abin Sur             112.
 4 Abomination          112.
 5 Abraxas              112.
 6 Absorbing Man        112.
 7 Adam Monroe          112.
 8 Adam Strange         112.
 9 Agent 13             112.
10 Agent Bob            112.
# … with 724 more rows</code></pre>
</div>
</div>
<p>Однако в функциях <code>mutate()</code> и <code>transmute()</code> правило ресайклинга не будет работать в остальных случаях: если полученный вектор будет не равен 1 или длине датафрейма, то мы получим ошибку.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">one_and_two =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `mutate()`:
ℹ In argument: `one_and_two = 1:2`.
Caused by error:
! `one_and_two` must be size 734 or 1, not 2.</code></pre>
</div>
</div>
<p>Это не баг, а фича: авторы пакета <code>dplyr</code> считают, что ресайклинг кратных друг другу векторов — это слишком удобное место для выстрелов себе в ногу. Поэтому в таких случаях разработчики <code>dplyr</code> рекомендуют использовать функцию <code>rep()</code>, знакомую нам уже очень давно (@ref(atomic)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">one_and_two =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">length.out =</span> <span class="fu">nrow</span>(.)))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 12
    ...1 name        Gender Eye c…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵
   &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1     0 A-Bomb      Male   yellow  Human No Hair    203 Marvel… &lt;NA&gt;    good   
 2     1 Abe Sapien  Male   blue    Icth… No Hair    191 Dark H… blue    good   
 3     2 Abin Sur    Male   blue    Unga… No Hair    185 DC Com… red     good   
 4     3 Abomination Male   green   Huma… No Hair    203 Marvel… &lt;NA&gt;    bad    
 5     4 Abraxas     Male   blue    Cosm… Black       NA Marvel… &lt;NA&gt;    bad    
 6     5 Absorbing … Male   blue    Human No Hair    193 Marvel… &lt;NA&gt;    bad    
 7     6 Adam Monroe Male   blue    &lt;NA&gt;  Blond       NA NBC - … &lt;NA&gt;    good   
 8     7 Adam Stran… Male   blue    Human Blond      185 DC Com… &lt;NA&gt;    good   
 9     8 Agent 13    Female blue    &lt;NA&gt;  Blond      173 Marvel… &lt;NA&gt;    good   
10     9 Agent Bob   Male   brown   Human Brown      178 Marvel… &lt;NA&gt;    good   
# … with 724 more rows, 2 more variables: Weight &lt;dbl&gt;, one_and_two &lt;int&gt;, and
#   abbreviated variable names ¹​`Eye color`, ²​`Hair color`, ³​Publisher,
#   ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
</section>
<section id="sec-tidy_aggregate" class="level2" data-number="10.9">
<h2 data-number="10.9" class="anchored" data-anchor-id="sec-tidy_aggregate"><span class="header-section-number">10.9</span> Агрегация данных в тиббле</h2>
<section id="sec-summarise" class="level3" data-number="10.9.1">
<h3 data-number="10.9.1" class="anchored" data-anchor-id="sec-summarise"><span class="header-section-number">10.9.1</span> Подытоживание: <code>summarise()</code></h3>
<p>Аггрегация по группам - это очень часто возникающая задача, например, это может использоваться для усреднения данных по испытуемым или условиям. Сделать аггрегацию в датафрейме удобной Хэдли Уикхэм пытался еще в предшественнике <code>dplyr</code>, пакете <code>plyr</code>. <code>dplyr</code> позволяет делать аггрегацию очень симпатичным и понятным способым. Аггрегация в <code>dplyr</code> состоит из двух этапов: группировки (<code>group_by()</code>) и подытоживания (<code>summarise()</code>). Начнем с последнего.</p>
<p>Функция <code>dplyr::summarise()</code><a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a> позволяет аггрегировать данные в тиббле. Работает она очень похоже на <code>mutate()</code>, но если внутри <code>mutate()</code> используются векторизованные функции, возвращающие вектор такой же длины, что и колонки, использовавшиеся для расчетов, то в <code>summarise()</code> используются функции, которые возвращают вектор длиной 1. Например, <code>min()</code>, <code>mean()</code>, <code>max()</code> и т.д. Можно создавать несколько колонок через запятую (это работает и для <code>mutate()</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">imt =</span> Weight<span class="sc">/</span>(Height<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">min</span>(imt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">max</span>(imt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  `min(imt, na.rm = TRUE)` `max(imt, na.rm = TRUE)`
                     &lt;dbl&gt;                    &lt;dbl&gt;
1                   0.0814                    2510.</code></pre>
</div>
</div>
<p>В <code>dplyr</code> есть дополнительные суммирующие функции для более удобного индексирования в стиле tidyverse. Например, функции <code>dplyr::nth()</code>, <code>dplyr::first()</code> и <code>dplyr::last()</code>, которые позволяют вытаскивать значения из вектора по индексу (что-то вроде <code>slice()</code>, но для векторов)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">imt =</span> Weight<span class="sc">/</span>(Height<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(imt) <span class="sc">%&gt;%</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">first =</span> <span class="fu">first</span>(imt),</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">tenth =</span> <span class="fu">nth</span>(imt, <span class="dv">10</span>),</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">last =</span> <span class="fu">last</span>(imt))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
   first tenth  last
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 0.0814  16.7    NA</code></pre>
</div>
</div>
<p>В отличие от <code>mutate()</code>, функции внутри <code>summarise()</code> вполне позволяют функциям внутри возвращать вектор из нескольких значений, создавая тиббл такой же длины, как и получившийся вектор.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">imt =</span> Weight<span class="sc">/</span>(Height<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">imt_range =</span> <span class="fu">range</span>(imt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="co">#функция range() возвращает вектор из двух значений: минимальное и максимальное</span></span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in
dplyr 1.1.0.
ℹ Please use `reframe()` instead.
ℹ When switching from `summarise()` to `reframe()`, remember that `reframe()`
  always returns an ungrouped data frame and adjust accordingly.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 1
  imt_range
      &lt;dbl&gt;
1    0.0814
2 2510.    </code></pre>
</div>
</div>
</section>
<section id="sec-tidy_group" class="level3" data-number="10.9.2">
<h3 data-number="10.9.2" class="anchored" data-anchor-id="sec-tidy_group"><span class="header-section-number">10.9.2</span> Группировка: <code>group_by()</code></h3>
<p><code>dplyr::group_by()</code> - это функция для группировки данных в тиббле по дискретной переменной для дальнейшей аггрегации с помощью <code>summarise()</code>. После применения <code>group_by()</code> тиббл будет выглядеть так же, но у него появятся атрибут <code>groups</code><a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Gender)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 11
# Groups:   Gender [3]
    ...1 name        Gender Eye c…¹ Race  Hair …² Height Publi…³ Skin …⁴ Align…⁵
   &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1     0 A-Bomb      Male   yellow  Human No Hair    203 Marvel… &lt;NA&gt;    good   
 2     1 Abe Sapien  Male   blue    Icth… No Hair    191 Dark H… blue    good   
 3     2 Abin Sur    Male   blue    Unga… No Hair    185 DC Com… red     good   
 4     3 Abomination Male   green   Huma… No Hair    203 Marvel… &lt;NA&gt;    bad    
 5     4 Abraxas     Male   blue    Cosm… Black       NA Marvel… &lt;NA&gt;    bad    
 6     5 Absorbing … Male   blue    Human No Hair    193 Marvel… &lt;NA&gt;    bad    
 7     6 Adam Monroe Male   blue    &lt;NA&gt;  Blond       NA NBC - … &lt;NA&gt;    good   
 8     7 Adam Stran… Male   blue    Human Blond      185 DC Com… &lt;NA&gt;    good   
 9     8 Agent 13    Female blue    &lt;NA&gt;  Blond      173 Marvel… &lt;NA&gt;    good   
10     9 Agent Bob   Male   brown   Human Brown      178 Marvel… &lt;NA&gt;    good   
# … with 724 more rows, 1 more variable: Weight &lt;dbl&gt;, and abbreviated variable
#   names ¹​`Eye color`, ²​`Hair color`, ³​Publisher, ⁴​`Skin color`, ⁵​Alignment</code></pre>
</div>
</div>
<p>Если после этого применить на тиббле функцию <code>summarise()</code>, то мы получим не тиббл длиной один, а тиббл со значением для каждой из групп.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">imt =</span> Weight<span class="sc">/</span>(Height<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Gender) <span class="sc">%&gt;%</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">min</span>(imt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">max</span>(imt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  Gender `min(imt, na.rm = TRUE)` `max(imt, na.rm = TRUE)`
  &lt;chr&gt;                     &lt;dbl&gt;                    &lt;dbl&gt;
1 Female                  15.5                       1613.
2 Male                     0.0814                    2510.
3 &lt;NA&gt;                    16.3                        114.</code></pre>
</div>
</div>
<p>Схематически это выглядит вот так:</p>
<p><img src="images/group_by_s.png" class="img-fluid" width="400"></p>
</section>
<section id="sec-tidy_count" class="level3" data-number="10.9.3">
<h3 data-number="10.9.3" class="anchored" data-anchor-id="sec-tidy_count"><span class="header-section-number">10.9.3</span> Подсчет строк: <code>dplyr::n()</code>, <code>dplyr::count()</code></h3>
<p>Для подсчет количества значений можно воспользоваться функцией <code>n()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Gender) <span class="sc">%&gt;%</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  Gender     n
  &lt;chr&gt;  &lt;int&gt;
1 Female   200
2 Male     505
3 &lt;NA&gt;      29</code></pre>
</div>
</div>
<p>Функция <code>n()</code> вместе с <code>group_by()</code> внутри <code>filter()</code> позволяет удобным образом “отрезать” от тиббла редкие группы…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Race) <span class="sc">%&gt;%</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, Race)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 611 × 2
# Groups:   Race [6]
   name          Race             
   &lt;chr&gt;         &lt;chr&gt;            
 1 A-Bomb        Human            
 2 Abomination   Human / Radiation
 3 Absorbing Man Human            
 4 Adam Monroe   &lt;NA&gt;             
 5 Adam Strange  Human            
 6 Agent 13      &lt;NA&gt;             
 7 Agent Bob     Human            
 8 Agent Zero    &lt;NA&gt;             
 9 Air-Walker    &lt;NA&gt;             
10 Ajax          Cyborg           
# … with 601 more rows</code></pre>
</div>
</div>
<p>или же наоборот, выделить только маленькие группы:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Race) <span class="sc">%&gt;%</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, Race)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 34 × 2
# Groups:   Race [34]
   name          Race              
   &lt;chr&gt;         &lt;chr&gt;             
 1 Abe Sapien    Icthyo Sapien     
 2 Abin Sur      Ungaran           
 3 Alien         Xenomorph XX121   
 4 Azazel        Neyaphem          
 5 Bizarro       Bizarro           
 6 Boba Fett     Human / Clone     
 7 Darth Maul    Dathomirian Zabrak
 8 Fin Fang Foom Kakarantharaian   
 9 Gamora        Zen-Whoberian     
10 Gladiator     Strontian         
# … with 24 more rows</code></pre>
</div>
</div>
<p>Таблицу частот можно создать без <code>group_by()</code> и <code>summarise(n = n())</code>. Функция <code>count()</code> заменяет эту конструкцию:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Gender)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  Gender     n
  &lt;chr&gt;  &lt;int&gt;
1 Female   200
2 Male     505
3 &lt;NA&gt;      29</code></pre>
</div>
</div>
<p>Эту таблицу частот удобно сразу проранжировать, указав в параметре <code>sort =</code> значение <code>TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Gender, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  Gender     n
  &lt;chr&gt;  &lt;int&gt;
1 Male     505
2 Female   200
3 &lt;NA&gt;      29</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Функция <code>count()</code>, несмотря на свою простоту, является одной из наиболее используемых в tidyverse.</p>
</blockquote>
</section>
<section id="sec-tidy_distinct" class="level3" data-number="10.9.4">
<h3 data-number="10.9.4" class="anchored" data-anchor-id="sec-tidy_distinct"><span class="header-section-number">10.9.4</span> Уникальные значения: <code>dplyr::distinct()</code></h3>
<p><code>dplyr::distinct()</code> - это более быстрый аналог <code>unique()</code>, позволяет извлекать уникальные значения для одной или нескольких колонок.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Gender)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 1
  Gender
  &lt;chr&gt; 
1 Male  
2 Female
3 &lt;NA&gt;  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Gender, Race)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 81 × 2
   Gender Race             
   &lt;chr&gt;  &lt;chr&gt;            
 1 Male   Human            
 2 Male   Icthyo Sapien    
 3 Male   Ungaran          
 4 Male   Human / Radiation
 5 Male   Cosmic Entity    
 6 Male   &lt;NA&gt;             
 7 Female &lt;NA&gt;             
 8 Male   Cyborg           
 9 Male   Xenomorph XX121  
10 Male   Android          
# … with 71 more rows</code></pre>
</div>
</div>
<p>Иногда нужно аггрегировать данные, но при этом сохранить исходную структуру тиббла. Например, нужно посчитать размер групп или посчитать средние значения по группе для последующего сравнения с индивидуальными значениями.</p>
</section>
<section id="sec-tidy_group_mutate" class="level3" data-number="10.9.5">
<h3 data-number="10.9.5" class="anchored" data-anchor-id="sec-tidy_group_mutate"><span class="header-section-number">10.9.5</span> Создание колонок с группировкой</h3>
<p>В tidyverse это можно сделать с помощью сочетания <code>group_by()</code> и <code>mutate()</code> (вместо <code>summarise()</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>heroes <span class="sc">%&gt;%</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Race) <span class="sc">%&gt;%</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Race_n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Race, name, Gender, Race_n)</span></code><button title="Скопировать текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 734 × 4
# Groups:   Race [62]
   Race              name          Gender Race_n
   &lt;chr&gt;             &lt;chr&gt;         &lt;chr&gt;   &lt;int&gt;
 1 Human             A-Bomb        Male      208
 2 Icthyo Sapien     Abe Sapien    Male        1
 3 Ungaran           Abin Sur      Male        1
 4 Human / Radiation Abomination   Male       11
 5 Cosmic Entity     Abraxas       Male        4
 6 Human             Absorbing Man Male      208
 7 &lt;NA&gt;              Adam Monroe   Male      304
 8 Human             Adam Strange  Male      208
 9 &lt;NA&gt;              Agent 13      Female    304
10 Human             Agent Bob     Male      208
# … with 724 more rows</code></pre>
</div>
</div>
<p>Результаты аггрегации были записаны в отдельную колонку, при этом значения этой колонки внутри одной группы повторяются:</p>
<p><img src="images/group_by_m.png" class="img-fluid" width="400"></p>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Как и пакет <code>tidyverse</code>, <code>tidymodels</code> — это пакет с несколькими пакетами.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Если быть точным, то оператор <code>%&gt;%</code> был импортирован во все основные пакеты tidyverse, а сам пакет <code>magrittr</code> не входит в базовый набор tidyverse. Тем не менее, в самом <code>magrittr</code> есть еще несколько интересных операторов.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Даже наоборот, использование пайпов незначительно снижает скорость выполнения команды.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p><a href="https://community.rstudio.com/t/pronunciations-of-common-r-terms/1810">Есть споры о том, как это правильно читать</a>. Используемые варианты: <em>диплаер</em>, <em>диплюр</em>, <em>диплир</em>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Как и в случае с <code>magrittr</code>, пакет <code>tidyselect</code> не содержатся в базовом tidyverse, но функции импортируются основыми пакетами tidyverse.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>Выбранный паттерн будет найден посимвольно, если же вы хотите искать по регулярным выражениям, то вместо <code>contains()</code> нужно использовать <code>matches()</code>.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p><code>relocate()</code> не позволяет переименовывать колонки в отличие от <code>select()</code> и <code>rename()</code><a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>У функции <code>dplyr::summarise()</code> есть синоним <code>dplyr::summarize()</code>, которая делает абсолбтно то же самое. Просто потому что в американском английском и британском английском это слово пишется по-разному.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>Снять группировку можно с помощью функции <code>ungroup()</code>.<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Скопировано");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Скопировано");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>

<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./107-beyond_base_r.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">За пределами base R: tidyverse и data.table</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./120-tidyverse_advanced.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Продвинутый tidyverse</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>